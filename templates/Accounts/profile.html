{% extends 'base.html' %}

{% block content %}
    <h1>{{ user.username }}'s Profile</h1>
    <hr>
    {% if user.profile.profile_picture %}
        <img src="{{ user.profile.profile_picture.url }}" alt="{{ user.username }}'s profile picture" style="width: 150px; height: 150px; border-radius: 50%;">
    {% else %}
        <img src="#" alt="Default profile picture" style="width: 150px; height: 150px; border-radius: 50%;">
    {% endif %}

    {% if user != request.user %}
        {% if is_following %}
            <form action="{% url 'unfollow_user' username=user.username %}" method="post">
                {% csrf_token %}
                <button type="submit">Unfollow</button>
            </form>
        {% else %}
            <form action="{% url 'follow_user' username=user.username %}" method="post">
                {% csrf_token %}
                <button type="submit">Follow</button>
            </form>
        {% endif %}
    {% else %}
        <p><a href="{% url 'profile_update' %}">Update Profile</a></p>
    {% endif %}

    <p>Followers: {{ followers_count }} | Following: {{ following_count }}</p>

    <h3>About Me</h3>
    <p>{{ user.profile.bio }}</p>

    <div style="margin-top: 20px;">
        <h2>Posts</h2>
        {% for post in posts %}
            <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
                {% if post.image %}
                    <img src="{{ post.image.url }}" style="max-width: 100%; height: auto;">
                {% endif %}
                <p>{{ post.caption }}</p>
                <p><small>Posted on {{ post.created_at|date:"F j, Y, P" }}</small></p>
            </div>
        {% empty %}
            <p>{{ user.username }} has not created any posts yet.</p>
        {% endfor %}
    </div>

{% endblock %}